!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var e=n();for(var i in e)("object"==typeof exports?exports:t)[i]=e[i]}}(this,function(){return function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(i,o,function(n){return t[n]}.bind(null,o));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e(1),o=e(2),r=function(){function t(t){this.options=t,this.onStateMap=new Map,this.onceStateMap=new Map,this.isPending=!1,this._onTransition={"*":function(){}},this.transitionCore=new i.TransitionCore(t.transitions,t.initState),this._onTransition=this.options.onTransition||this._onTransition,this.step=this.step.bind(this),this.on=this.on.bind(this),this.execTransition=this.execTransition.bind(this),this.runHookFunction=this.runHookFunction.bind(this)}return t.prototype.on=function(t,n){return!!~this.transitionCore.getStates().indexOf(t)&&(this.onStateMap.has(t)?this.onStateMap.get(t).push(n):this.onStateMap.set(t,[n]),!0)},t.prototype.once=function(t,n){return!!~this.transitionCore.getStates().indexOf(t)&&(this.onceStateMap.has(t)?this.onceStateMap.get(t).push(n):this.onceStateMap.set(t,[n]),!0)},t.prototype.off=function(t,n){var e=this.onStateMap.get(t),i=this.onceStateMap.get(t);e&&~e.indexOf(n)&&e.splice(e.indexOf(n),1),i&&~i.indexOf(n)&&i.splice(i.indexOf(n),1)},t.prototype.removeListener=function(t,n){this.off(t,n)},t.prototype.removeAllListener=function(t){t?(this.onStateMap.delete(t),this.onceStateMap.delete(t)):(this.onStateMap.clear(),this.onceStateMap.clear())},t.prototype.getMethods=function(t){return this.transitionCore.getMethods(t)},t.prototype.getStateList=function(){return this.transitionCore.getStates()},t.prototype.getState=function(){return this.transitionCore.state},t.prototype.step=function(t){for(var n,e,i=this,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];if(!0===this.isPending)return console.warn("Transition still working"),!1;try{if(this.isPending=!0,!(e=(n=this.transitionCore).stepTo.apply(n,[t].concat(o))))return!1}catch(t){throw this.isPending=!1,t}if(e instanceof Promise)return e.then(this.execTransition).then(function(){return i.runHookFunction(),i.transitionCore.currentTransitionEvent}).catch(function(t){throw t}).finally(function(){i.isPending=!1});var s=void 0;try{s=this.execTransition()}catch(t){throw this.isPending=!1,t}return s instanceof Promise?s.then(function(){return i.runHookFunction(),i.transitionCore.currentTransitionEvent}).catch(function(t){throw t}).finally(function(){i.isPending=!1}):(this.runHookFunction(),this.isPending=!1,this.transitionCore.currentTransitionEvent)},t.prototype.execTransition=function(){var t=this.transitionCore.currentTransitionEvent;if("function"==typeof this._onTransition)return this._onTransition(t),!0;var n=this._onTransition["*"]&&this._onTransition["*"](t),e=this._onTransition[t.on]&&this._onTransition[t.on](t);return!o.fnsHasPromise(n,e)||Promise.resolve().then(function(){return n}).then(function(){return e}).then(function(){return!0})},t.prototype.runHookFunction=function(){var t=this.transitionCore.currentTransitionEvent,n=t.on,e=t.arg,i=this.onStateMap.get(n),o=this.onceStateMap.get(n);if(i&&i.forEach(function(t){return t.apply(void 0,e)}),o)for(;o.length;)o.shift().apply(void 0,e)},t.prototype.can=function(t){return!!~this.transitionCore.getMethods().indexOf(t)},t.prototype.canTransitionTo=function(t){return this.transitionCore.canTransitionTo(t)},t}();n.StateMachine=r,n.default=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,n){var e=this;this.transitionGroups=t,this.initState=n,this.transitionMap=new Map,this.stateList=new Set,this.transitionMethods=new Map,this._state=null,this._transitionEvent=null,this._state=n,this.transitionGroups.forEach(function(t){var n=t.from+"/"+t.action;if(e.transitionMap.has(n))throw new Error("From "+t.from+" to "+("function"==typeof t.to?t.to():t.to)+" with "+t.action+" has repeated declarative");e.transitionMap.set(t.from+"/"+t.action,Object.freeze(t)),!e.stateList.has(t.from)&&"*"!==t.from&&e.stateList.add(t.from),e.transitionMethods.has(t.from)?e.transitionMethods.get(t.from).push(t.action):e.transitionMethods.set(t.from,[t.action]),"string"==typeof t.to&&!e.stateList.has(t.to)&&e.stateList.add(t.to)}),this.stepTo=this.stepTo.bind(this),this.getMethods=this.getMethods.bind(this),this.getStates=this.getStates.bind(this),this.stateOnTransition=this.stateOnTransition.bind(this)}return t.prototype.stepTo=function(t){for(var n=this,e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=this._state,r=this._state+"/"+t;if(this.transitionMap.has("*/"+t))r="*/"+t;else if(!this.transitionMap.has(r))return console.warn("Cannot transition with "+t),!1;var s=Object.assign({},this.transitionMap.get(r)),a=!s.guardian||s.guardian.apply(s,e);return a instanceof Promise?Promise.resolve().then(function(){return a}).then(function(t){return s.from=o,t}).then(function(t){return!!t&&n.stateOnTransition.apply(n,[s].concat(e))}):!!a&&(s.from=o,this.stateOnTransition.apply(this,[s].concat(e)))},t.prototype.getMethods=function(t){return void 0===t&&(t=this._state),this.transitionMethods.get(t)},t.prototype.getStates=function(){var t=[];return this.stateList.forEach(function(n){return t.push(n)}),t},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTransitionEvent",{get:function(){return this._transitionEvent},enumerable:!0,configurable:!0}),t.prototype.canTransitionTo=function(t){var n=this;return this.getMethods().some(function(e){return n.transitionMap.get(n._state+"/"+e).to===t})},t.prototype.stateOnTransition=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var i="function"==typeof t.to?t.to.apply(t,n):t.to;return this.stateList.has(i)?(this._state=i,this._transitionEvent={before:t.from,on:this._state,action:t.action,arg:n},!0):(this._transitionEvent=null,!1)},t}();n.TransitionCore=i},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fnsHasPromise=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some(function(t){return t instanceof Promise})}}])});