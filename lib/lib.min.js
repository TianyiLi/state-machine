!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var i=n();for(var e in i)("object"==typeof exports?exports:t)[e]=i[e]}}(this,function(){return function(t){var n={};function i(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=n,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)i.d(e,o,function(n){return t[n]}.bind(null,o));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=0)}([function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e=i(1),o=i(2),r=function(){function t(t){this.options=t,this.onStateMap=new Map,this.onceStateMap=new Map,this.isPending=!1,this._onTransition={"*":function(){}},this.transitionCore=new e.TransitionCore(t.transitions,t.initState),this._onTransition=this.options.onTransition||this._onTransition,this.step=this.step.bind(this),this.on=this.on.bind(this),this.execTransition=this.execTransition.bind(this),this.runHookFunction=this.runHookFunction.bind(this)}return t.prototype.on=function(t,n){return!!~this.transitionCore.getStates().indexOf(t)&&(this.onStateMap.has(t)?this.onStateMap.get(t).push(n):this.onStateMap.set(t,[n]),!0)},t.prototype.once=function(t,n){return!!~this.transitionCore.getStates().indexOf(t)&&(this.onceStateMap.has(t)?this.onceStateMap.get(t).push(n):this.onceStateMap.set(t,[n]),!0)},t.prototype.off=function(t,n){var i=this.onStateMap.get(t),e=this.onceStateMap.get(t);i&&~i.indexOf(n)&&i.splice(i.indexOf(n),1),e&&~e.indexOf(n)&&e.splice(e.indexOf(n),1)},t.prototype.removeAllListener=function(t){t?(this.onStateMap.delete(t),this.onceStateMap.delete(t)):(this.onStateMap.clear(),this.onceStateMap.clear())},t.prototype.getMethods=function(t){return this.transitionCore.getMethods(t)},t.prototype.getStateList=function(){return this.transitionCore.getStates()},t.prototype.getState=function(){return this.transitionCore.state},t.prototype.step=function(t){for(var n,i,e=this,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];if(!0===this.isPending)return console.warn("Transition still working"),!1;try{if(this.isPending=!0,!(i=(n=this.transitionCore).stepTo.apply(n,[t].concat(o))))return!1}catch(t){throw this.isPending=!1,t}if(i instanceof Promise)return i.then(this.execTransition).then(function(){return e.runHookFunction(),e.transitionCore.currentTransitionEvent}).catch(function(t){throw t}).finally(function(){e.isPending=!1});var s=void 0;try{s=this.execTransition()}catch(t){throw this.isPending=!1,t}return s instanceof Promise?s.then(function(){return e.runHookFunction(),e.transitionCore.currentTransitionEvent}).catch(function(t){throw t}).finally(function(){e.isPending=!1}):(this.runHookFunction(),this.isPending=!1,this.transitionCore.currentTransitionEvent)},t.prototype.execTransition=function(){var t=this.transitionCore.currentTransitionEvent;if("function"==typeof this._onTransition)return this._onTransition(t),!0;var n=this._onTransition["*"]&&this._onTransition["*"](t),i=this._onTransition[t.on]&&this._onTransition[t.on](t);return!o.fnsHasPromise(n,i)||Promise.resolve().then(function(){return n}).then(function(){return i}).then(function(){return!0})},t.prototype.runHookFunction=function(){var t=this.transitionCore.currentTransitionEvent,n=t.on,i=t.arg,e=this.onStateMap.get(n),o=this.onceStateMap.get(n);if(e&&e.forEach(function(t){return t.apply(void 0,i)}),o)for(;o.length;)o.shift().apply(void 0,i)},t.prototype.can=function(t){return!!~this.transitionCore.getMethods().indexOf(t)},t.prototype.canTransitionTo=function(t){return this.transitionCore.canTransitionTo(t)},t}();n.StateMachine=r,n.default=r},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e=function(){function t(t,n){var i=this;this.transitionGroups=t,this.initState=n,this.transitionMap=new Map,this.stateList=new Set,this.transitionMethods=new Map,this._state=null,this._transitionEvent=null,this._state=n,this.transitionGroups.forEach(function(t){var n=t.from+"/"+t.action;if(i.transitionMap.has(n))throw new Error("From "+t.from+" to "+("function"==typeof t.to?t.to():t.to)+" with "+t.action+" has repeated declarative");i.transitionMap.set(t.from+"/"+t.action,Object.freeze(t)),!i.stateList.has(t.from)&&"*"!==t.from&&i.stateList.add(t.from),i.transitionMethods.has(t.from)?i.transitionMethods.get(t.from).push(t.action):i.transitionMethods.set(t.from,[t.action]),"string"==typeof t.to&&!i.stateList.has(t.to)&&i.stateList.add(t.to)}),this.stepTo=this.stepTo.bind(this),this.getMethods=this.getMethods.bind(this),this.getStates=this.getStates.bind(this),this.stateOnTransition=this.stateOnTransition.bind(this)}return t.prototype.stepTo=function(t){for(var n=this,i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var o=this._state,r=this._state+"/"+t;if(this.transitionMap.has("*/"+t))r="*/"+t;else if(!this.transitionMap.has(r))return console.warn("Cannot transition with "+t),!1;var s=Object.assign({},this.transitionMap.get(r)),a=!s.guardian||s.guardian.apply(s,i);return a instanceof Promise?Promise.resolve().then(function(){return a}).then(function(t){return s.from=o,t}).then(function(t){return!!t&&n.stateOnTransition.apply(n,[s].concat(i))}):!!a&&(s.from=o,this.stateOnTransition.apply(this,[s].concat(i)))},t.prototype.getMethods=function(t){return void 0===t&&(t=this._state),this.transitionMethods.get(t)},t.prototype.getStates=function(){var t=[];return this.stateList.forEach(function(n){return t.push(n)}),t},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTransitionEvent",{get:function(){return this._transitionEvent},enumerable:!0,configurable:!0}),t.prototype.canTransitionTo=function(t){var n=this;return this.getMethods().some(function(i){return n.transitionMap.get(n._state+"/"+i).to===t})},t.prototype.stateOnTransition=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var e="function"==typeof t.to?t.to.apply(t,n):t.to;return this.stateList.has(e)?(this._state=e,this._transitionEvent={before:t.from,on:this._state,action:t.action,arg:n},!0):(this._transitionEvent=null,!1)},t}();n.TransitionCore=e},function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fnsHasPromise=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some(function(t){return t instanceof Promise})}}])});